{"version":3,"sources":["src/module-auto-dialer-modify-polling.js"],"names":["idUrl","idForm","baseUrl","window","location","protocol","hostname","port","ModuleAutoDialer","$formObj","$","$checkBoxes","$dropDowns","validateRules","initialize","removeClass","accordion","checkbox","dropdown","initializeForm","tab","document","on","deletePollingRowClick","addQuestion","currentSegment","closest","previousSegment","prev","length","insertBefore","val","Date","trigger","nextSegment","next","insertAfter","remove","off","event","preventDefault","ajax","url","type","dataType","contentType","data","JSON","stringify","transformObject","form","success","response","console","log","result","Form","initializeDirrity","id","newUrl","history","pushState","path","error","xhr","status","stringId","toString","padStart","templateHtml","html","replaceAll","newElement","append","input","crmId","parseInt","name","questions","Object","keys","forEach","key","segments","keyMatch","match","questionId","questionIndex","targetTextarea","parentSegment","index","nextQuestionIndex","question","questionText","defPress","timeout","press","i","actionKey","valueKey","valueOptionsKey","action","nextQuestion","value","valueOptions","push","sort","a","b","e","linkElement","attr","calculatePageLength","rowHeight","$pollingTable","find","first","outerHeight","windowHeight","innerHeight","headerFooterHeight","Math","max","floor","cbBeforeSendForm","settings","cbAfterSendForm","globalRootUrl","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 11 2018\n *\n */\nconst idUrl     = 'module-auto-dialer';\nconst idForm    = 'poling-form';\nlet baseUrl = window.location.protocol + '//' + window.location.hostname;\nif (window.location.port) {\n\tbaseUrl += ':' + window.location.port;\n}\n/* global globalRootUrl, globalTranslate, Form, Config */\nconst ModuleAutoDialer = {\n\t$formObj: $('#'+idForm),\n\t$checkBoxes: $('#'+idForm+' .ui.checkbox'),\n\t$dropDowns: $('#'+idForm+' .ui.dropdown'),\n\n\t/**\n\t * Field validation rules\n\t * https://semantic-ui.com/behaviors/form.html\n\t */\n\tvalidateRules: {\n\t},\n\t/**\n\t * On page load we init some Semantic UI library\n\t */\n\tinitialize() {\n\t\t$('#content-frame').removeClass('segment');\n\t\t$('.ui.accordion').accordion();\n\t\t// инициализируем чекбоксы и выподающие менюшки\n\t\tModuleAutoDialer.$checkBoxes.checkbox();\n\t\tModuleAutoDialer.$dropDowns.dropdown();\n\t\tModuleAutoDialer.initializeForm();\n\t\t$('.menu .item').tab();\n\t\t$(document).on('click', 'a.delete', ModuleAutoDialer.deletePollingRowClick);\n\t\t$('#button-add-question').on('click', ModuleAutoDialer.addQuestion);\n\n\t\t$(document).on('click', 'div.ui.segment button[data-type=\"up\"]', function() {\n\t\t\tlet currentSegment = $(this).closest('div.ui.segment');\n\t\t\tlet previousSegment = currentSegment.prev('div.ui.segment');\n\t\t\tif (previousSegment.length) {\n\t\t\t\tcurrentSegment.insertBefore(previousSegment);\n\t\t\t}\n\t\t\t$('input[name=\"change-signal\"]').val(new Date()).trigger('change');;\n\t\t});\n\t\t$(document).on('click', 'div.ui.segment button[data-type=\"down\"]', function() {\n\t\t\tlet currentSegment = $(this).closest('div.ui.segment');\n\t\t\tlet nextSegment = currentSegment.next('div.ui.segment');\n\t\t\tif (nextSegment.length) {\n\t\t\t\tcurrentSegment.insertAfter(nextSegment);\n\t\t\t}\n\t\t\t$('input[name=\"change-signal\"]').val(new Date()).trigger('change');;\n\n\t\t});\n\t\t$(document).on('click', 'div.ui.segment button[data-type=\"remove\"]', function() {\n\t\t\t$(this).closest('div.ui.segment').remove();\n\t\t\t$('input[name=\"change-signal\"]').val(new Date()).trigger('change');;\n\t\t});\n\n\t\t$('#submitbutton').off('click').on('click', function(event) {\n\t\t\tevent.preventDefault();\n\t\t\t$.ajax({\n\t\t\t\turl: baseUrl+ '/pbxcore/api/module-dialer/v1/polling',\n\t\t\t\ttype: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\tcontentType: 'application/json',\n\t\t\t\tdata: JSON.stringify(ModuleAutoDialer.transformObject(ModuleAutoDialer.$formObj.form('get values'))),\n\t\t\t\tsuccess: function(response) {\n\t\t\t\t\tconsole.log('Успех:', response);\n\t\t\t\t\tif(response.result){\n\t\t\t\t\t\tForm.initializeDirrity();\n\t\t\t\t\t\t$('input[name=\"id\"]').val(response.data.id);\n\t\t\t\t\t\tlet newUrl = baseUrl + '/admin-cabinet/module-auto-dialer/modifyPolling/'+response.data.id;\n\t\t\t\t\t\twindow.history.pushState({path: newUrl}, '', newUrl);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function(xhr, status, error) {\n\t\t\t\t\tconsole.log('Ошибка:', error);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\taddQuestion(){\n\t\tlet id = 1;\n\t\tlet stringId = id.toString().padStart(9, '0');\n\t\twhile ($('textarea[name=\"questionText-' + stringId + '\"]').length > 0) {\n\t\t\tid++;\n\t\t\tstringId = id.toString().padStart(9, '0');\n\t\t}\n\t\tlet templateHtml = $('div[data-is-template=\"1\"]').html().replaceAll('000000000',stringId);\n\n\t\tlet newElement = $('<div class=\"ui segment\" data-is-template=\"0\"></div>').html(templateHtml);\n\t\t$('div.ui.form').append(newElement);\n\t\t$('.ui.accordion').accordion();\n\t\t$('#'+idForm+' .ui.dropdown').dropdown();\n\n\t\t$('input[name=\"change-signal\"]').val(new Date()).trigger('change');\n\t\tModuleAutoDialer.$formObj.form();\n\t},\n\n\ttransformObject(input) {\n\t\t// Начальный объект\n\t\tconst result = {\n\t\t\tid: input.id,\n\t\t\tcrmId: parseInt(input.id, 10),\n\t\t\tname: input.name,\n\t\t\tquestions: []\n\t\t};\n\n\t\t// Перебираем все свойства объекта input\n\t\tObject.keys(input).forEach(key => {\n\t\t\tconst segments = $('div.ui.segment[data-is-template=\"0\"]');\n\t\t\tconst keyMatch = key.match(/^questionText-(\\d+)$/);\n\t\t\t// Проверяем, является ли ключ частью вопроса\n\t\t\tif (keyMatch) {\n\t\t\t\tconst questionId = keyMatch[1];\n\t\t\t\tlet questionIndex = '';\n\n\t\t\t\tlet targetTextarea = $('textarea[name=\"questionText-'+questionId+'\"]');\n\t\t\t\tlet parentSegment = targetTextarea.closest('div.ui.segment[data-is-template=\"0\"]');\n\t\t\t\tif (parentSegment.length > 0) {\n\t\t\t\t\tquestionIndex = segments.index(parentSegment);\n\t\t\t\t}\n\t\t\t\tif(questionIndex === ''){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet nextQuestionIndex = questionIndex+1;\n\t\t\t\tif(segments.length <= nextQuestionIndex){\n\t\t\t\t\tnextQuestionIndex =''\n\t\t\t\t}\n\t\t\t\tconst question = {\n\t\t\t\t\tquestionId: questionIndex,\n\t\t\t\t\tquestionText: input[`questionText-${questionId}`],\n\t\t\t\t\tdefPress: input[`defPress-${questionId}`] || \"\",\n\t\t\t\t\ttimeout: parseInt(input[`timeout-${questionId}`], 10),\n\t\t\t\t\tpress: []\n\t\t\t\t};\n\t\t\t\t// Ищем кнопки press-0 и press-1 для каждого вопроса\n\t\t\t\tfor (let i = 0; i < 2; i++) {\n\t\t\t\t\tconst actionKey = `${questionId}-press-${i}-action`;\n\t\t\t\t\tconst valueKey = `${questionId}-press-${i}-value`;\n\t\t\t\t\tconst valueOptionsKey = `${questionId}-press-${i}-valueOptions`;\n\t\t\t\t\tif (input[actionKey]) {\n\t\t\t\t\t\tconst press = {\n\t\t\t\t\t\t\tkey: i.toString(),\n\t\t\t\t\t\t\taction: input[actionKey],\n\t\t\t\t\t\t\tnextQuestion: nextQuestionIndex\n\t\t\t\t\t\t};\n\t\t\t\t\t\t// Добавляем значения value и valueOptions, если они существуют\n\t\t\t\t\t\tif (input[valueKey]) press.value = input[valueKey];\n\t\t\t\t\t\tif (input[valueOptionsKey]) press.valueOptions = input[valueOptionsKey];\n\t\t\t\t\t\t// Добавляем press в массив press текущего вопроса\n\t\t\t\t\t\tquestion.press.push(press);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Добавляем вопрос в массив questions\n\t\t\t\tresult.questions.push(question);\n\t\t\t}\n\t\t});\n\t\tresult.questions.sort((a, b) => a.questionId - b.questionId);\n\t\treturn result;\n\t},\n\n\tdeletePollingRowClick(e){\n\t\te.preventDefault();\n\t\tlet linkElement = $(this);\n\n\t\t$.ajax({\n\t\t\turl: linkElement.attr('href'),\n\t\t\ttype: 'DELETE',\n\t\t\tdataType: 'json',\n\t\t\tsuccess: function(response) {\n\t\t\t\tif (response.result) {\n\t\t\t\t\tlinkElement.closest('tr').remove();\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function(xhr, status, error) {\n\t\t\t\tconsole.error(\"Ошибка при удалении: \" + error);\n\t\t\t}\n\t\t});\n\t},\n\n\tcalculatePageLength() {\n\t\tlet rowHeight = ModuleAutoDialer.$pollingTable.find('tbody > tr').first().outerHeight();\n\t\tconst windowHeight = window.innerHeight;\n\t\tconst headerFooterHeight = 400 ;\n\t\treturn Math.max(Math.floor((windowHeight - headerFooterHeight) / rowHeight), 5);\n\t},\n\n\t/**\n\t * We can modify some data before form send\n\t * @param settings\n\t * @returns {*}\n\t */\n\tcbBeforeSendForm(settings) {\n\t\tconst result = settings;\n\t\tresult.data = ModuleAutoDialer.$formObj.form('get values');\n\t\treturn result;\n\t},\n\t/**\n\t * Some actions after forms send\n\t */\n\tcbAfterSendForm() {\n\t\t//\n\t},\n\t/**\n\t * Initialize form parameters\n\t */\n\tinitializeForm() {\n\t\tForm.$formObj = ModuleAutoDialer.$formObj;\n\t\tForm.url = `${globalRootUrl}${idUrl}/save`;\n\t\tForm.validateRules = ModuleAutoDialer.validateRules;\n\t\tForm.cbBeforeSendForm = ModuleAutoDialer.cbBeforeSendForm;\n\t\tForm.cbAfterSendForm = ModuleAutoDialer.cbAfterSendForm;\n\t\tForm.initialize();\n\t}\n};\n\n$(document).ready(() => {\n\tModuleAutoDialer.initialize();\n});\n\n"],"file":"module-auto-dialer-modify-polling.js"}