{"version":3,"sources":["src/module-auto-dialer-modify-polling.js"],"names":["idUrl","idForm","baseUrl","window","location","protocol","hostname","port","ModuleAutoDialer","$formObj","$","$checkBoxes","$dropDowns","validateRules","initialize","removeClass","accordion","checkbox","dropdown","onChange","value","text","choice","val","closest","find","attr","hide","show","each","index","element","initializeForm","tab","document","on","deletePollingRowClick","addQuestion","currentSegment","previousSegment","prev","length","insertBefore","Date","trigger","nextSegment","next","insertAfter","remove","off","event","preventDefault","ajax","url","type","dataType","contentType","data","JSON","stringify","transformObject","form","success","response","console","log","result","Form","initializeDirrity","id","newUrl","history","pushState","path","error","xhr","status","stringId","toString","padStart","templateHtml","html","replaceAll","newElement","append","input","crmId","parseInt","name","questions","Object","keys","forEach","key","segments","keyMatch","match","questionId","questionIndex","targetTextarea","parentSegment","nextQuestionIndex","question","questionText","defPress","timeout","press","i","actionKey","valueKey","valueOptionsKey","action","nextQuestion","valueOptions","push","sort","a","b","e","linkElement","calculatePageLength","rowHeight","$pollingTable","first","outerHeight","windowHeight","innerHeight","headerFooterHeight","Math","max","floor","cbBeforeSendForm","settings","cbAfterSendForm","globalRootUrl","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 11 2018\n *\n */\nconst idUrl     = 'module-auto-dialer';\nconst idForm    = 'poling-form';\nlet baseUrl = window.location.protocol + '//' + window.location.hostname;\nif (window.location.port) {\n\tbaseUrl += ':' + window.location.port;\n}\n/* global globalRootUrl, globalTranslate, Form, Config */\nconst ModuleAutoDialer = {\n\t$formObj: $('#'+idForm),\n\t$checkBoxes: $('#'+idForm+' .ui.checkbox'),\n\t$dropDowns: $('#'+idForm+' .ui.dropdown'),\n\n\t/**\n\t * Field validation rules\n\t * https://semantic-ui.com/behaviors/form.html\n\t */\n\tvalidateRules: {\n\t},\n\t/**\n\t * On page load we init some Semantic UI library\n\t */\n\tinitialize() {\n\t\t$('#content-frame').removeClass('segment');\n\t\t$('.ui.accordion').accordion();\n\t\t// инициализируем чекбоксы и выподающие менюшки\n\t\tModuleAutoDialer.$checkBoxes.checkbox();\n\t\tModuleAutoDialer.$dropDowns.dropdown();\n\t\t$(\"div.dropdown.press\").dropdown({\n\t\t\tonChange: function (value, text, choice) {\n\t\t\t\tlet val = choice.closest('div.dropdown.press').dropdown('get value');\n\t\t\t\tif(val === 'answer'){\n\t\t\t\t\tchoice.closest('div.press-section').find('[data-key=\"'+choice.closest('div.press-section').attr('data-key')+'\"]').hide();\n\t\t\t\t}else{\n\t\t\t\t\tchoice.closest('div.press-section').find('[data-key=\"'+choice.closest('div.press-section').attr('data-key')+'\"]').show();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t$(\"div.dropdown.press\").each(function(index, element) {\n\n\t\t\tlet val = $(element).dropdown('get value');\n\t\t\tif(val === 'answer'){\n\t\t\t\t$(element).closest('div.press-section').find('[data-key=\"'+$(element).closest('div.press-section').attr('data-key')+'\"]').hide();\n\t\t\t}else{\n\t\t\t\t$(element).closest('div.press-section').find('[data-key=\"'+$(element).closest('div.press-section').attr('data-key')+'\"]').show();\n\t\t\t}\n\t\t});\n\n\t\tModuleAutoDialer.initializeForm();\n\t\t$('.menu .item').tab();\n\t\t$(document).on('click', 'a.delete', ModuleAutoDialer.deletePollingRowClick);\n\t\t$('#button-add-question').on('click', ModuleAutoDialer.addQuestion);\n\n\t\t$(document).on('click', 'div.ui.segment button[data-type=\"up\"]', function() {\n\t\t\tlet currentSegment = $(this).closest('div.ui.segment');\n\t\t\tlet previousSegment = currentSegment.prev('div.ui.segment');\n\t\t\tif (previousSegment.length) {\n\t\t\t\tcurrentSegment.insertBefore(previousSegment);\n\t\t\t}\n\t\t\t$('input[name=\"change-signal\"]').val(new Date()).trigger('change');;\n\t\t});\n\t\t$(document).on('click', 'div.ui.segment button[data-type=\"down\"]', function() {\n\t\t\tlet currentSegment = $(this).closest('div.ui.segment');\n\t\t\tlet nextSegment = currentSegment.next('div.ui.segment');\n\t\t\tif (nextSegment.length) {\n\t\t\t\tcurrentSegment.insertAfter(nextSegment);\n\t\t\t}\n\t\t\t$('input[name=\"change-signal\"]').val(new Date()).trigger('change');;\n\n\t\t});\n\t\t$(document).on('click', 'div.ui.segment button[data-type=\"remove\"]', function() {\n\t\t\t$(this).closest('div.ui.segment').remove();\n\t\t\t$('input[name=\"change-signal\"]').val(new Date()).trigger('change');;\n\t\t});\n\n\t\t$('#submitbutton').off('click').on('click', function(event) {\n\t\t\tevent.preventDefault();\n\t\t\t$.ajax({\n\t\t\t\turl: baseUrl+ '/pbxcore/api/module-dialer/v1/polling',\n\t\t\t\ttype: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\tcontentType: 'application/json',\n\t\t\t\tdata: JSON.stringify(ModuleAutoDialer.transformObject(ModuleAutoDialer.$formObj.form('get values'))),\n\t\t\t\tsuccess: function(response) {\n\t\t\t\t\tconsole.log('Успех:', response);\n\t\t\t\t\tif(response.result){\n\t\t\t\t\t\tForm.initializeDirrity();\n\t\t\t\t\t\t$('input[name=\"id\"]').val(response.data.id);\n\t\t\t\t\t\tlet newUrl = baseUrl + '/admin-cabinet/module-auto-dialer/modifyPolling/'+response.data.id;\n\t\t\t\t\t\twindow.history.pushState({path: newUrl}, '', newUrl);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function(xhr, status, error) {\n\t\t\t\t\tconsole.log('Ошибка:', error);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\taddQuestion(){\n\t\tlet id = 1;\n\t\tlet stringId = id.toString().padStart(9, '0');\n\t\twhile ($('textarea[name=\"questionText-' + stringId + '\"]').length > 0) {\n\t\t\tid++;\n\t\t\tstringId = id.toString().padStart(9, '0');\n\t\t}\n\t\tlet templateHtml = $('div[data-is-template=\"1\"]').html().replaceAll('000000000',stringId);\n\n\t\tlet newElement = $('<div class=\"ui segment\" data-is-template=\"0\"></div>').html(templateHtml);\n\t\t$('div.ui.form').append(newElement);\n\t\t$('.ui.accordion').accordion();\n\t\t$('#'+idForm+' .ui.dropdown').dropdown();\n\n\t\t$('input[name=\"change-signal\"]').val(new Date()).trigger('change');\n\t\tModuleAutoDialer.$formObj.form();\n\t},\n\n\ttransformObject(input) {\n\t\t// Начальный объект\n\t\tconst result = {\n\t\t\tid: input.id,\n\t\t\tcrmId: parseInt(input.id, 10),\n\t\t\tname: input.name,\n\t\t\tquestions: []\n\t\t};\n\n\t\t// Перебираем все свойства объекта input\n\t\tObject.keys(input).forEach(key => {\n\t\t\tconst segments = $('div.ui.segment[data-is-template=\"0\"]');\n\t\t\tconst keyMatch = key.match(/^questionText-(\\d+)$/);\n\t\t\t// Проверяем, является ли ключ частью вопроса\n\t\t\tif (keyMatch) {\n\t\t\t\tconst questionId = keyMatch[1];\n\t\t\t\tlet questionIndex = '';\n\n\t\t\t\tlet targetTextarea = $('textarea[name=\"questionText-'+questionId+'\"]');\n\t\t\t\tlet parentSegment = targetTextarea.closest('div.ui.segment[data-is-template=\"0\"]');\n\t\t\t\tif (parentSegment.length > 0) {\n\t\t\t\t\tquestionIndex = segments.index(parentSegment);\n\t\t\t\t}\n\t\t\t\tif(questionIndex === ''){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet nextQuestionIndex = questionIndex+1;\n\t\t\t\tif(segments.length <= nextQuestionIndex){\n\t\t\t\t\tnextQuestionIndex =''\n\t\t\t\t}\n\t\t\t\tconst question = {\n\t\t\t\t\tquestionId: questionIndex,\n\t\t\t\t\tquestionText: input[`questionText-${questionId}`],\n\t\t\t\t\tdefPress: input[`defPress-${questionId}`] || \"\",\n\t\t\t\t\ttimeout: parseInt(input[`timeout-${questionId}`], 10),\n\t\t\t\t\tpress: []\n\t\t\t\t};\n\t\t\t\t// Ищем кнопки press-0 и press-1 для каждого вопроса\n\t\t\t\tfor (let i = 0; i < 2; i++) {\n\t\t\t\t\tconst actionKey = `${questionId}-press-${i}-action`;\n\t\t\t\t\tconst valueKey = `${questionId}-press-${i}-value`;\n\t\t\t\t\tconst valueOptionsKey = `${questionId}-press-${i}-valueOptions`;\n\t\t\t\t\tif (input[actionKey]) {\n\t\t\t\t\t\tconst press = {\n\t\t\t\t\t\t\tkey: i.toString(),\n\t\t\t\t\t\t\taction: input[actionKey],\n\t\t\t\t\t\t\tnextQuestion: nextQuestionIndex\n\t\t\t\t\t\t};\n\t\t\t\t\t\t// Добавляем значения value и valueOptions, если они существуют\n\t\t\t\t\t\tif (input[valueKey]) press.value = input[valueKey];\n\t\t\t\t\t\tif (input[valueOptionsKey]) press.valueOptions = input[valueOptionsKey];\n\t\t\t\t\t\t// Добавляем press в массив press текущего вопроса\n\t\t\t\t\t\tquestion.press.push(press);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Добавляем вопрос в массив questions\n\t\t\t\tresult.questions.push(question);\n\t\t\t}\n\t\t});\n\t\tresult.questions.sort((a, b) => a.questionId - b.questionId);\n\t\treturn result;\n\t},\n\n\tdeletePollingRowClick(e){\n\t\te.preventDefault();\n\t\tlet linkElement = $(this);\n\n\t\t$.ajax({\n\t\t\turl: linkElement.attr('href'),\n\t\t\ttype: 'DELETE',\n\t\t\tdataType: 'json',\n\t\t\tsuccess: function(response) {\n\t\t\t\tif (response.result) {\n\t\t\t\t\tlinkElement.closest('tr').remove();\n\t\t\t\t}\n\t\t\t},\n\t\t\terror: function(xhr, status, error) {\n\t\t\t\tconsole.error(\"Ошибка при удалении: \" + error);\n\t\t\t}\n\t\t});\n\t},\n\n\tcalculatePageLength() {\n\t\tlet rowHeight = ModuleAutoDialer.$pollingTable.find('tbody > tr').first().outerHeight();\n\t\tconst windowHeight = window.innerHeight;\n\t\tconst headerFooterHeight = 400 ;\n\t\treturn Math.max(Math.floor((windowHeight - headerFooterHeight) / rowHeight), 5);\n\t},\n\n\t/**\n\t * We can modify some data before form send\n\t * @param settings\n\t * @returns {*}\n\t */\n\tcbBeforeSendForm(settings) {\n\t\tconst result = settings;\n\t\tresult.data = ModuleAutoDialer.$formObj.form('get values');\n\t\treturn result;\n\t},\n\t/**\n\t * Some actions after forms send\n\t */\n\tcbAfterSendForm() {\n\t\t//\n\t},\n\t/**\n\t * Initialize form parameters\n\t */\n\tinitializeForm() {\n\t\tForm.$formObj = ModuleAutoDialer.$formObj;\n\t\tForm.url = `${globalRootUrl}${idUrl}/save`;\n\t\tForm.validateRules = ModuleAutoDialer.validateRules;\n\t\tForm.cbBeforeSendForm = ModuleAutoDialer.cbBeforeSendForm;\n\t\tForm.cbAfterSendForm = ModuleAutoDialer.cbAfterSendForm;\n\t\tForm.initialize();\n\t}\n};\n\n$(document).ready(() => {\n\tModuleAutoDialer.initialize();\n});\n\n"],"file":"module-auto-dialer-modify-polling.js"}